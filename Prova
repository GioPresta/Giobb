Certo! Ecco lo script completo aggiornato che usa encoding='latin-1' per leggere correttamente i file .txt, evitando l‚Äôerrore di decodifica:


---

üêç Script Python aggiornato (usa latin-1)

import os

def process_file(filepath, include_header):
    with open(filepath, 'r', encoding='latin-1') as f:
        raw_lines = f.readlines()

    output = []
    i = 0
    found_header = False

    # Cerca la riga con "LIVELLO"
    while i < len(raw_lines):
        if 'LIVELLO' in raw_lines[i]:
            found_header = True
            break
        i += 1

    if found_header:
        header_start = i
        header_end = i + 6  # 6 righe totali: LIVELLO + 5
        if include_header:
            output.extend(raw_lines[header_start:header_end])
        i = header_end + 4  # salta 4 righe dopo
    else:
        return []  # File non valido o struttura diversa

    # Estrai righe fino agli asterischi
    while i < len(raw_lines):
        line = raw_lines[i]
        if line.strip().startswith('***'):
            break
        # Salta riga se fatta solo di trattini
        if not set(line.strip()).issubset(set('-')):
            output.append(line)
        i += 1

    return output


def main():
    current_dir = os.path.dirname(os.path.abspath(__file__))
    txt_files = [f for f in os.listdir(current_dir) if f.endswith('.txt')]
    txt_files.sort()

    merged_output = []
    for idx, filename in enumerate(txt_files):
        filepath = os.path.join(current_dir, filename)
        include_header = idx == 0  # Solo il primo file ha intestazione
        result = process_file(filepath, include_header)
        if result:
            merged_output.append(f'--- FILE: {filename} ---\n')
            merged_output.extend(result)
            merged_output.append('\n')

    output_path = os.path.join(current_dir, 'output_merged.txt')
    with open(output_path, 'w', encoding='utf-8') as out_f:
        out_f.writelines(merged_output)

    print(f'‚úÖ File creato: {output_path}')


if __name__ == "__main__":
    main()


---

üìÇ Output

Il file output_merged.txt conterr√†:

L‚Äôintestazione LIVELLO + 5 righe solo dal primo file.

I dati utili da tutti i file (ignorando trattini e fermandosi agli asterischi).

Separatore --- FILE: nomefile.txt --- tra ogni blocco.


Fammi sapere se vuoi anche:

Ignorare i file vuoti.

Escludere i separatori.

Semplificare l‚Äôoutput ancora di pi√π.


Pronto per l‚Äôuso ‚Äî puoi incollarlo e lanciarlo direttamente!
