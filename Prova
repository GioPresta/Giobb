Perfetto! Ecco la versione dello script che legge i file da una cartella specifica (a tua scelta), ad esempio:

C:/ReportBatch/


---

‚úÖ COSA CAMBIA

Non prende i .txt dalla cartella dello script

Ma da un percorso preciso che puoi modificare

Tutto il resto resta uguale: 6 righe intestazione, 4 trattini ignorati, polizze lette, output in riepilogo.txt e riepilogo.csv



---

üßæ SCRIPT COMPLETO ‚Äì con percorso cartella personalizzato

import os
import re
import csv

# üîÅ IMPOSTA QUI IL PERCORSO DELLA CARTELLA DEI FILE
cartella_input = r'C:/ReportBatch'  # <-- cambia questo percorso a piacere

# Pattern riconoscimento struttura file
inizio_intestazione = re.compile(r'\bLIVELLO\b', re.IGNORECASE)
riga_asterischi = re.compile(r'^\*{5,}$')
riga_decorativa = re.compile(r'^[-\s]{10,}$')

header_lines = []
righe_dati = []
intestazione_salvata = False

# Elenco dei file txt nella cartella scelta
file_txt = [f for f in os.listdir(cartella_input) if f.endswith('.txt') and not f.startswith('riepilogo')]

if not file_txt:
    print("‚ùå Nessun file .txt trovato nella cartella:", cartella_input)
    exit()

for nome_file in file_txt:
    percorso_file = os.path.join(cartella_input, nome_file)

    with open(percorso_file, 'r', encoding='latin1') as f:
        lines = f.readlines()

        # Trova riga con "LIVELLO"
        start_index = None
        for i, line in enumerate(lines):
            if inizio_intestazione.search(line.strip()):
                start_index = i
                break
        else:
            print(f"‚ö† 'LIVELLO' non trovato in {nome_file}")
            continue

        # Salva le 6 righe di intestazione (una volta sola)
        if not intestazione_salvata:
            header_lines = [lines[start_index + j].rstrip('\n') for j in range(6)]
            intestazione_salvata = True

        # Salta le 4 righe di trattini dopo l‚Äôintestazione
        index = start_index + 10

        # Legge i dati (fino agli asterischi)
        for line in lines[index:]:
            riga = line.strip()
            if riga_asterischi.match(riga):
                break
            if riga:
                righe_dati.append(riga)

# Crea intestazioni CSV combinando verticalmente le 6 righe
def crea_colonne_da_header(righe):
    split = [re.split(r'\s{2,}', r.strip()) for r in righe]
    max_col = max(len(r) for r in split)
    for r in split:
        while len(r) < max_col:
            r.append('')
    return [' '.join(col).strip() for col in zip(*split)]

final_headers = crea_colonne_da_header(header_lines)

# Scrittura riepilogo.txt nella stessa cartella dello script
with open('riepilogo.txt', 'w', encoding='utf-8') as f:
    for r in header_lines:
        f.write(r + '\n')
    for r in righe_dati:
        f.write(r + '\n')

# Scrittura riepilogo.csv
with open('riepilogo.csv', 'w', encoding='utf-8', newline='') as f:
    writer = csv.writer(f, delimiter=';')
    writer.writerow(final_headers)
    for r in righe_dati:
        valori = re.split(r'\s{2,}', r.strip())
        writer.writerow(valori)

print(f"\n‚úÖ Fatti! Letti {len(file_txt)} file da: {cartella_input}")
print(f"üìÑ Trovate {len(righe_dati)} righe dati.")
print("üìù File salvati: riepilogo.txt + riepilogo.csv")


---

üìå ISTRUZIONI

1. Cambia questa riga con la cartella dove hai



