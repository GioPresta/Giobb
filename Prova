Perfetto, ripartiamo da zero, chiari e semplici come vuoi tu âœ…


---

ðŸŽ¯ Obiettivo finale (definitivo)

Leggere tutti i file .txt nella cartella

In ognuno:

Cercare il blocco dati che inizia con la riga LIVELLO

Prendere solo lâ€™intestazione del primo file

Prendere tutte le righe sotto quellâ€™intestazione (fino alla riga con *****)


Ignorare:

intestazioni ripetute

righe vuote

righe decorative (solo trattini o asterischi)


Salvare tutto in:

âœ… riepilogo.txt

âœ… riepilogo.csv leggibile da Excel




---

âœ… Codice completo e corretto (chiaro, semplice)

import os
import re
import csv

# Pattern per trovare inizio, fine e righe inutili
inizio_tabella = re.compile(r'^\s*LIVELLO\b', re.IGNORECASE)
fine_tabella = re.compile(r'^\s*\*{5,}\s*$')
decorazioni = re.compile(r'^[\s\-\*=_\.]{4,}$')

# Dove salvo le righe
intestazione = None
righe_dati = []

# Scorro tutti i file txt nella cartella
for nome_file in os.listdir():
    if nome_file.endswith('.txt') and not nome_file.startswith('riepilogo'):
        with open(nome_file, 'r', encoding='latin1') as f:
            dentro_blocco = False
            for riga in f:
                riga_pulita = riga.strip()

                # Inizio del blocco: prendi intestazione solo una volta
                if not dentro_blocco and inizio_tabella.match(riga_pulita):
                    if intestazione is None:
                        intestazione = riga_pulita
                    dentro_blocco = True
                    continue  # salta questa riga, giÃ  salvata

                # Fine del blocco
                if dentro_blocco and fine_tabella.match(riga_pulita):
                    break

                # Se siamo dentro al blocco e la riga Ã¨ valida, salvala
                if dentro_blocco:
                    if riga_pulita and not decorazioni.match(riga_pulita):
                        righe_dati.append(riga_pulita)

# Scrivi il file TXT
with open('riepilogo.txt', 'w', encoding='utf-8') as f:
    if intestazione:
        f.write(intestazione + '\n')
    for r in righe_dati:
        f.write(r + '\n')

# Scrivi anche un file CSV per Excel
with open('riepilogo.csv', 'w', encoding='utf-8', newline='') as f:
    writer = csv.writer(f, delimiter=';')
    if intestazione:
        colonne = re.split(r'\s{2,}', intestazione.strip())
        writer.writerow(colonne)
    for r in righe_dati:
        valori = re.split(r'\s{2,}', r.strip())
        writer.writerow(valori)

print("âœ… Fatto! Tutti i contenuti sono sotto unâ€™unica intestazione.")


---

âœ… Cosa ottieni

riepilogo.txt

LIVELLO  POLIZZA  ADESIONE  EFFETTO  ERRORE
3        123456   0101      2025-07  RuntimeException
3        789012   0102      2025-07  NullPointerException
...

riepilogo.csv

Apribile in Excel

Colonne


